import { HookTypeScriptHints } from '../components'
import { Link } from '@brillout/docpress'

The `onBeforeRender()` hook is usually used together with [`passToClient`](/passToClient) to fetch data, see [Guides > Data Fetching](/data-fetching).

By default it is only loaded in Node.js, so ORM/SQL database queries can be used.

```js
// /pages/movies/+onBeforeRender.js

// Note how we use `node-fetch`; this file is only run in Node.js by default, thus we don't need
// to use an isomorphic (aka universal) implementation such as `cross-fetch`.
import fetch from 'node-fetch'

export { onBeforeRender }

async function onBeforeRender(pageContext){
  const response = await fetch("https://api.imdb.com/api/movies/")
  const { movies } = await response.json()
  /* Or with an ORM:
  const movies = Movie.findAll() */
  /* Or with SQL:
  const movies = sql`SELECT * FROM movies;` */
  return {
    pageContext: {
      pageProps: {
        movies
      }
    }
  }
}
```

Examples:
- <Link href='/examples/react-full-v1/pages/star-wars/index/+onBeforeRender.ts' />
- <Link href='/examples/vue-full-v1/pages/star-wars/index/+onBeforeRender.ts' />

You can also provide initial `pageContext` values at your server middleware with <Link text={<code>renderPage(pageContextInit)</code>} href="/renderPage" />.
This is where you usually pass information about the authenticated user
(see <Link href="/auth" />).

> You can also suppress on a per-page basis globally defined `onBeforeRender()` hooks:
> ```js
> // /pages/+onBeforeRender.js
>
> // Some global onBeforeRender() hook
> export default () => {
>   // ...
> }
> ```
> ```js
> // /pages/some-page/+config.h.js
>
> export default {
>   // Suppress the global onBeforeRender() hook
>   onBeforeRender: null
> }
> ```


## TypeScript

```ts
export { onBeforeRender }

import type { OnBeforeRenderAsync } from 'vike/types'

const onBeforeRender: OnBeforeRenderAsync = async (
  pageContext
): ReturnType<OnBeforeRenderAsync> => {
  const response = await fetch("https://api.imdb.com/api/movies/")
  const { movies } = await response.json()
  return {
    pageContext: {
      pageProps: {
        movies
      }
    }
  }
}
```

<HookTypeScriptHints hookTypeName="OnBeforeRenderAsync" />


## Client Routing

If you use <Link href="/clientRouting" noBreadcrumb />,
you have the option to [also run `onBeforeRender()` in the client](/onBeforeRender-isomorphic);
the hook is then called not only in Node.js but also in the browser.
